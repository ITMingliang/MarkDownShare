# 数据绑定控件

ASP.NET中包含一系列的控件，专用于显示独立数据源的数据，可以通过这些控件，以可视化的方式查看绑定数据

之后的效果。这些控件称为数据绑定控件。

## 一、资料准备

本章所有数据绑定控件都以此处提供的资料作为基础进行编码演示。

**数据库代码：**

```
--专业
create table Major
(
	MajorId int primary key identity(1,1), --编号
	MajorName varchar(50) not null --专业名称
)
insert into Major(MajorName) values('计算机科学与应用')
insert into Major(MajorName) values('建筑学')
insert into Major(MajorName) values('美术学')
insert into Major(MajorName) values('戏剧与影视学')

--学生
create table Student
(
	StudentId int primary key identity(1,1), --编号
	MajorId int not null, --专业编号
	StudentName varchar(50) not null, --学生姓名
	StudentSex varchar(50) not null, --学生性别
	StudentPhone varchar(50) not null, --电话
	StudentMail varchar(50) not null, --邮箱
	StudentImg varchar(50) not null --相片
)

insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(1,'刘备','男','13554878965','liubei@qq.com','1.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(1,'关羽','男','15389874521','guanyu@qq.com','2.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(2,'张飞','男','18987542525','zhangfei@qq.com','3.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(2,'赵云','男','13696896547','zhaoyun@qq.com','4.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(3,'黄忠','男','13778777888','huangzhong@qq.com','5.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(3,'马超','男','13221212325','machao@qq.com','6.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(4,'魏延','男','13996147455','weiyan@qq.com','7.jpg')
insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg)
values(4,'周仓','男','13437522241','zhoucang@qq.com','8.jpg')
```

**实体类：**

```
public class MajorEntity
{
    public int MajorId { get; set; } //编号
    public string MajorName { get; set; } //专业名称
}
```

```
public class StudentEntity
{

    public int StudentId { get; set; } //编号
    public int MajorId { get; set; } //专业编号
    public string StudentName { get; set; } //学生性别
    public string StudentSex { get; set; } //学生性别
    public string StudentPhone { get; set; } //学生电话
    public string StudentMail { get; set; } //学生邮箱
    public string StudentImg { get; set; } //学生照片

    //添加对象方便查询
    public MajorEntity Major { get; set; } //专业对象
}
```

**数据访问代码（DBhelper参考第一章）:**

```
public class MajorDAL
{
    DBHelper db = new DBHelper();

    #region 添加
    public int Add(MajorEntity entity)
    {
        string sql = "insert into Major(MajorName) values(@MajorName)";
        db.PrepareSql(sql);
        db.SetParameter("MajorName", entity.MajorName);
        return db.ExecNonQuery();
    }
    #endregion

    #region 删除
    public int Delete(int id)
    {
        string sql = "delete from Major where MajorId = " + id;
        db.PrepareSql(sql);
        return db.ExecNonQuery();
    }
    #endregion

    #region 修改
    public int Update(MajorEntity entity)
    {
        string sql = "update Major set MajorName=@MajorName where MajorId=@MajorId";
        db.PrepareSql(sql);
        db.SetParameter("MajorName", entity.MajorName);
        db.SetParameter("MajorId",entity.MajorId);
        return db.ExecNonQuery();
    }
    #endregion

    #region 列表
    public List<MajorEntity> List()
    {
        string sql = "select * from Major";
        db.PrepareSql(sql);
        DataTable dt = new DataTable();
        dt = db.ExecQuery();
        List<MajorEntity> list = new List<MajorEntity>();
        foreach (DataRow item in dt.Rows)
        {
            MajorEntity entity = new MajorEntity();
            entity.MajorId = int.Parse(item["MajorId"].ToString());
            entity.MajorName = item["MajorName"].ToString();
            list.Add(entity);
        }
        return list;
    }
    public DataTable Select()
    {
        string sql = "select * from Major";
        db.PrepareSql(sql);
        DataTable dt = new DataTable();
        dt = db.ExecQuery();
        return dt;
    }
    #endregion

    #region 详情
    public MajorEntity Detail(int id)
    {
        string sql = "select * from Major where MajorId = " + id;
        db.PrepareSql(sql);
        DataTable dt = new DataTable();
        dt = db.ExecQuery();
        if (dt.Rows.Count == 0)
            return null;
        MajorEntity entity = new MajorEntity();
        entity.MajorId = int.Parse(dt.Rows[0]["MajorId"].ToString());
        entity.MajorName = dt.Rows[0]["MajorName"].ToString();
        return entity;
    }
    #endregion
}
```

```
public class StudentDAL
{
    DBHelper db = new DBHelper();

    #region 添加
    public int Add(StudentEntity entity)
    {
        string sql = "insert into Student(MajorId,StudentName,StudentSex,StudentPhone,StudentMail,StudentImg) values(@MajorId,@StudentName,@StudentSex,@StudentPhone,@StudentMail,@StudentImg)";
        db.PrepareSql(sql);
        db.SetParameter("MajorId",entity.MajorId);
        db.SetParameter("StudentName", entity.StudentName);
        db.SetParameter("StudentSex", entity.StudentSex);
        db.SetParameter("StudentPhone", entity.StudentPhone);
        db.SetParameter("StudentMail", entity.StudentMail);
        db.SetParameter("StudentImg", entity.StudentImg);
        return db.ExecNonQuery();
    }
    #endregion

    #region 删除
    public int Delete(int id)
    {
        string sql = "delete from Student where StudentId = " + id;
        db.PrepareSql(sql);
        return db.ExecNonQuery();
    }
    public int Delete(string IdList)
    {
        string sql = "delete from Student where StudentId in(" + IdList + ")";
        db.PrepareSql(sql);
        return db.ExecNonQuery();
    }
    #endregion

    #region 修改
    public int Update(StudentEntity entity)
    {
        string sql = "update Student set MajorId=@MajorId,StudentName=@StudentName,StudentSex=@StudentSex,StudentPhone=@StudentPhone,StudentMail=@StudentMail,StudentImg=@StudentImg where StudentId=@StudentId";
        db.PrepareSql(sql);
        db.SetParameter("MajorId", entity.MajorId);
        db.SetParameter("StudentName", entity.StudentName);
        db.SetParameter("StudentSex", entity.StudentSex);
        db.SetParameter("StudentPhone", entity.StudentPhone);
        db.SetParameter("StudentMail", entity.StudentMail);
        db.SetParameter("StudentImg", entity.StudentImg);
        db.SetParameter("StudentId", entity.StudentId);
        return db.ExecNonQuery();
    }
    #endregion

    #region 列表
    public List<StudentEntity> List()
    {
        string sql = "select * from Student inner join Major on Student.MajorId = Major.MajorId";
        db.PrepareSql(sql);
        DataTable dt = new DataTable();
        dt = db.ExecQuery();
        List<StudentEntity> list = new List<StudentEntity>();
        foreach (DataRow item in dt.Rows)
        {
            StudentEntity entity = new StudentEntity();
            entity.StudentId = int.Parse(item["StudentId"].ToString());
            entity.MajorId = int.Parse(item["MajorId"].ToString());
            entity.StudentName = item["StudentName"].ToString();
            entity.StudentSex = item["StudentSex"].ToString();
            entity.StudentPhone = item["StudentPhone"].ToString();
            entity.StudentMail = item["StudentMail"].ToString();
            entity.StudentImg = item["StudentImg"].ToString();
            //-----------------------------------------------------------------
            entity.Major = new MajorEntity();
            entity.Major.MajorName = item["MajorName"].ToString();
            list.Add(entity);
        }
        return list;
    }
    public DataTable Select()
    {
        string sql = "select * from Student inner join Major on Student.MajorId = Major.MajorId";
        db.PrepareSql(sql);
        DataTable dt = new DataTable();
        dt = db.ExecQuery();
        return dt;
    }

    public List<StudentEntity> ListPage(int pageSize, int pageIndex, out int recordCount)
    {
        //求总记录数量
        string sqlCount = "select count(*) from Student inner join Major on Student.MajorId = Major.MajorId where 1 = 1 ";
        db.PrepareSql(sqlCount);
        recordCount = (int)db.ExecScalar();
        //重新计算pageIndex
        pageIndex = PageHelper.ComputeCurrPage(pageIndex, pageSize, recordCount);
        DataTable dt = new DataTable();
        string sql = "select * from (select ROW_NUMBER() over(order by StudentId desc) RowId,Student.*, Major.MajorName from Student inner join Major on Student.MajorId = Major.MajorId where 1 = 1) Temp where RowId between @Start and @End ";
        db.PrepareSql(sql);
        db.SetParameter("Start", (pageIndex - 1) * pageSize + 1);
        db.SetParameter("End", pageIndex * pageSize);
        dt = db.ExecQuery();
        List<StudentEntity> list = new List<StudentEntity>();
        foreach (DataRow item in dt.Rows)
        {
            StudentEntity entity = new StudentEntity();
            entity.StudentId = int.Parse(item["StudentId"].ToString());
            entity.MajorId = int.Parse(item["MajorId"].ToString());
            entity.StudentName = item["StudentName"].ToString();
            entity.StudentSex = item["StudentSex"].ToString();
            entity.StudentPhone = item["StudentPhone"].ToString();
            entity.StudentMail = item["StudentMail"].ToString();
            entity.StudentImg = item["StudentImg"].ToString();
            //-----------------------------------------------------------------
            entity.Major = new MajorEntity();
            entity.Major.MajorName = item["MajorName"].ToString();
            list.Add(entity);
        }
        return list;
    }
    public DataTable ListPageDataTable(int pageSize, int pageIndex, out int recordCount)
    {
        //求总记录数量
        string sqlCount = "select count(*) from Student inner join Major on Student.MajorId = Major.MajorId where 1 = 1 ";
        db.PrepareSql(sqlCount);
        recordCount = (int)db.ExecScalar();
        //重新计算pageIndex
        pageIndex = PageHelper.ComputeCurrPage(pageIndex, pageSize, recordCount);
        DataTable dt = new DataTable();
        string sql = "select * from (select ROW_NUMBER() over(order by StudentId desc) RowId,Student.*, Major.MajorName from Student inner join Major on Student.MajorId = Major.MajorId where 1 = 1) Temp where RowId between @Start and @End ";
        db.PrepareSql(sql);
        db.SetParameter("Start", (pageIndex - 1) * pageSize + 1);
        db.SetParameter("End", pageIndex * pageSize);
        dt = db.ExecQuery();
        return dt;
    }
    #endregion

    #region 详情
    public StudentEntity Detail(int id)
    {
        string sql = "select * from Student where StudentId = " + id;
        db.PrepareSql(sql);
        DataTable dt = new DataTable();
        dt = db.ExecQuery();
        if (dt.Rows.Count == 0)
            return null;
        StudentEntity entity = new StudentEntity();
        entity.StudentId = int.Parse(dt.Rows[0]["StudentId"].ToString());
        entity.MajorId = int.Parse(dt.Rows[0]["MajorId"].ToString());
        entity.StudentName = dt.Rows[0]["StudentName"].ToString();
        entity.StudentSex = dt.Rows[0]["StudentSex"].ToString();
        entity.StudentPhone = dt.Rows[0]["StudentPhone"].ToString();
        entity.StudentMail = dt.Rows[0]["StudentMail"].ToString();
        entity.StudentImg = dt.Rows[0]["StudentImg"].ToString();
        return entity;
    }
    #endregion
}
```

## 二、DropDownList

```
属性					   描述
AutoPostBack			用于设置当下拉列表项发生变化时，是否主动向服务器提交整个表单，默认是false，即不                         主动提交。如果设置为true，则可执行SelectedIndexChanged事件处理方法
DataTextField			设置列表项的可见部分的文字
DataValueField			设置列表项的值部分
Items					获取控件的列表项的集合
SelectedIndex			获取或设置DropDownList控件中的选定项的索引
SelectedItem			获取列表控件中索引最小的选定项
SelectedValue			获取列表控件中选定项的值，或选择列表控件中包含指定值的项
```

**使用DropDownList绑定专业数据：**

```
<asp:DropDownList ID="ddlMajor" runat="server"></asp:DropDownList>
```

```
public partial class Demo01 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindDropDown();
    }

    #region 绑定下拉框
    private void BindDropDown()
    {
        //方案一（DataTable作为数据源）：
        //MajorDAL dal = new MajorDAL();
        //this.ddlMajor.DataTextField = "MajorName";
        //this.ddlMajor.DataValueField = "MajorId";
        //this.ddlMajor.DataSource = dal.Select();
        //this.ddlMajor.DataBind();
        //this.ddlMajor.Items.Insert(0, new ListItem("--请选择--", "0"));

        //方案二(List<T>作为数据源)
        MajorDAL dal = new MajorDAL();
        this.ddlMajor.DataTextField = "MajorName";
        this.ddlMajor.DataValueField = "MajorId";
        this.ddlMajor.DataSource = dal.List();
        this.ddlMajor.DataBind();
        this.ddlMajor.Items.Insert(0, new ListItem("--请选择--", "0"));
    }
    #endregion
}
```

## 三、Repeater

Repeater控件完全由模板驱动，可以任意设置其输出格式。

Repeater控件不生成任何类似于“<Table>”的布局代码，它为显示数据库记录提供了最大限度的灵活性。

在使用Repeater控件时，只能在“源”视图进行编辑。

Repeater控件一共有5个模板 ：    

```
<HeaderTemplate>这里是头部模板</HeaderTemplate>
<ItemTemplate>这里是数据项模板</ItemTemplate>
<SeparatorTemplate>分隔符模板</SeparatorTemplate>
<AlternatingItemTemplate>交替项模板</AlternatingItemTemplate>
<FooterTemplate>脚部模板</FooterTemplate>
```

### （1）Repeater绑定数组

```
<div>
	<h2>Repeater绑定数组</h2>
    <asp:Repeater ID="rptArray" runat="server">
    	<HeaderTemplate>全球知名IT公司<ul></HeaderTemplate>
    	<ItemTemplate><li style="color:Green;"><%#Container.DataItem %></li></ItemTemplate>
    	<SeparatorTemplate>-----------------------</SeparatorTemplate>
    	<AlternatingItemTemplate><li style="color:red;"><%#Container.DataItem %></li></AlternatingItemTemplate>
    	<FooterTemplate></ul></FooterTemplate>
    </asp:Repeater>
</div>
```

```
public partial class Demo02 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            BindArray();
        }
    }

    #region repeater控件绑定数组元素
    private void BindArray()
    {
        string[] arr = new string[] { "谷歌","微软","苹果","华为","小米","腾讯"};
        this.rptArray.DataSource = arr;
        this.rptArray.DataBind();
    }
    #endregion
}
```

### （2）Repeater绑定DataTable

```
<div>
	<h2>Repeater绑定DataTable</h2>
    <asp:Repeater ID="rptStudent" runat="server">
        <HeaderTemplate>
        <table id="MyTable">
            <tr>
            <th>编号</th><th>专业</th><th>姓名</th><th>性别</th><th>电话</th><th>邮箱</th>
            </tr>
        </HeaderTemplate>
        <ItemTemplate>
            <tr>
            <td><%#Eval("StudentId")%></td>
            <td><%#Eval("MajorName")%></td>
            <td><%#Eval("StudentName")%></td>
            <td><%#Eval("StudentSex")%></td>
            <td><%#Eval("StudentPhone")%></td>
            <td><%#Eval("StudentMail")%></td>
            </tr>
        </ItemTemplate>
        <FooterTemplate>
        	</table>
        </FooterTemplate>
    </asp:Repeater>
</div>
```

```
public partial class Demo02 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            BindStudent();
        }
    }
    
    #region 绑定学生信息-表格
    private void BindStudent()
    {
        StudentDAL dal = new StudentDAL();
        this.rptStudent.DataSource = dal.Select();
        this.rptStudent.DataBind();
    }
    #endregion
}
```

### （3）Repeater绑定List集合

**表格形式展示数据：**

```
<h2>Repeater绑定数据-表格样式</h2>
<asp:Repeater ID="rptStudentOne" runat="server">
    <HeaderTemplate>
        <table id="MyTable">
        <tr>
        	<th>编号</th><th>专业</th><th>姓名</th><th>性别</th><th>电话</th><th>邮箱</th>
        </tr>
    </HeaderTemplate>
    <ItemTemplate>
        <tr>
            <td><%#Eval("StudentId")%></td>
            <td><%#Eval("Major.MajorName")%></td>
            <td><%#Eval("StudentName")%></td>
            <td><%#Eval("StudentSex")%></td>
            <td><%#Eval("StudentPhone")%></td>
            <td><%#Eval("StudentMail")%></td>
        </tr>
    </ItemTemplate>
    <FooterTemplate>
        </table>
    </FooterTemplate>
</asp:Repeater>
```

```
public partial class Demo02_01 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            BindStudent();
        }
    }

    #region 绑定学生信息-表格
    private void BindStudent()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.rptStudentOne.DataSource = list;
        this.rptStudentOne.DataBind();
    }
    #endregion
}
```

**列表图文混排展示数据：**

```
<style type="text/css">
    .divStudent{width:300px; height:160px; float:left; border:solid 1px gray; margin:6px;}
    .divLeft{width:130px; text-align:center; float:left;}
    .divLeft img{ width:120px; height:150px; margin-top:5px;}
    .divRight{width:160px; float:left;}
    .divRight ul{ list-style-type:none; margin:0px; padding:0px;}
    .divRight li{ height:30px; line-height:30px; font-size:13px;}
</style>
<h2>Repeater绑定数据-图片文字混排</h2>
<asp:Repeater ID="rptStudentTwo" runat="server">
    <HeaderTemplate>
    	<div>
    </HeaderTemplate>
    <ItemTemplate>
        <div class="divStudent">
            <div class="divLeft">
                <img src="img/<%#Eval("StudentImg") %>" alt="" />
                </div>
                <div class="divRight">
                <ul>
                <li>专业：<%#Eval("Major.MajorName")%></li>
                <li>姓名：<%#Eval("StudentName")%></li>
                <li>性别：<%#Eval("StudentSex")%></li>
                <li>电话：<%#Eval("StudentPhone")%></li>
                <li>邮箱：<%#Eval("StudentMail")%></li>
            </ul>
            </div>
        </div>
    </ItemTemplate>
    <FooterTemplate>
    	</div>
    </FooterTemplate>
</asp:Repeater>
```

```
public partial class Demo02_01 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            BindStudent();
        }
    }

    #region 绑定学生信息-表格
    private void BindStudent()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.rptStudentTwo.DataSource = list;
        this.rptStudentTwo.DataBind();
    }
    #endregion
}
```

### （4）Repeater中的按钮事件

在学生信息表格中实现删除和超看照片的功能：

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Repeater中的按钮类事件处理</title>
    <style type="text/css">
        #MyTable{ border-collapse:collapse; border:solid 1px gray; width:1000px;}
        #MyTable td,#MyTable th{border-collapse:collapse; border:solid 1px gray; margin:0px;}
    </style>
</head>
<body>
    <form id="form1" runat="server">
        <div style=" width:1000px; float:left;">
            <asp:Repeater ID="rptStudent" runat="server" 
                onitemcommand="rptStudent_ItemCommand">
                <HeaderTemplate>
                    <table id="MyTable">
                        <tr>
                            <th>编号</th><th>专业</th><th>姓名</th><th>性别</th><th>电话</th><th>邮箱</th><th>操作</th>
                        </tr>
                </HeaderTemplate>
                <ItemTemplate>
                        <tr>
                            <td><%#Eval("StudentId")%></td>
                            <td><%#Eval("Major.MajorName")%></td>
                            <td><%#Eval("StudentName")%></td>
                            <td><%#Eval("StudentSex")%></td>
                            <td><%#Eval("StudentPhone")%></td>
                            <td><%#Eval("StudentMail")%></td>
                            <td>
                                <asp:Button ID="btDelete" runat="server" Text="删除" CommandName="del" CommandArgument='<%#Eval("StudentId")%>' OnClientClick="return confirm('是否确定删除');" />
                                <asp:LinkButton ID="btShowImg" runat="server" CommandName="showImg" CommandArgument='<%#Eval("StudentImg")+","+Eval("StudentName")%>'>查看照片</asp:LinkButton>
                            </td>
                        </tr>
                </ItemTemplate>
                <FooterTemplate>
                    </table>
                </FooterTemplate>
            </asp:Repeater>
        </div>
        <div style=" width:150px; float:left; margin-left:10px;">
            <asp:Image ID="imgPhoto" runat="server" Width="120" Height="150" /><br />
            <asp:Label ID="lblName" runat="server" ></asp:Label>
        </div>
    </form>
</body>
</html>
```

```
public partial class Demo02_02 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindStudent();
    }

    #region 绑定学生信息-表格
    private void BindStudent()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        //绑定第一个repeater
        this.rptStudent.DataSource = list;
        this.rptStudent.DataBind();
    }
    #endregion

    #region 执行repeater中的命令
    protected void rptStudent_ItemCommand(object source, RepeaterCommandEventArgs e)
    {
        if (e.CommandName.Equals("del")) //删除操作
        {
            StudentDAL dal = new StudentDAL();
            dal.Delete(int.Parse(e.CommandArgument.ToString()));
            Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('删除成功');</script>");
            BindStudent();           
        }
        if (e.CommandName.Equals("showImg")) //显示图片操作
        { 
            string[] arr = e.CommandArgument.ToString().Split(',');
            this.imgPhoto.ImageUrl = "img/" + arr[0];
            this.lblName.Text = arr[1];
        }
    }
    #endregion
}
```

### （5）Repeater嵌套

绑定显示专业数据，在专业数据下绑定学生数据（即根据专业分组显示学生信息）。

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Repeater嵌套</title>
    <style type="text/css">
        .divStudent{width:300px; height:160px; float:left; border:solid 1px gray; margin:6px;}
        .divLeft{width:130px; text-align:center; float:left;}
        .divLeft img{ width:120px; height:150px; margin-top:5px;}
        .divRight{width:160px; float:left;}
        .divRight ul{ list-style-type:none; margin:0px; padding:0px;}
        .divRight li{ height:30px; line-height:30px; font-size:13px; margin:0px; padding:0px;}
    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <h2>Repeater嵌套绑定数据</h2>
        <asp:Repeater ID="rptMajor" runat="server" 
            onitemdatabound="rptMajor_ItemDataBound">
            <ItemTemplate>
                <asp:HiddenField ID="hdMajorId" runat="server" Value='<%# Eval("MajorId") %>' />
                <h4 style="clear:both; margin:3px;"><%#Eval("MajorName")%></h4>
                <asp:Repeater ID="rptStudent" runat="server">
                    <HeaderTemplate>
                        <div style=" clear:both; margin-bottom:20px; height:auto; overflow:hidden; margin:0px;">
                    </HeaderTemplate>
                    <ItemTemplate>
                        <div class="divStudent">
                            <div class="divLeft">
                                <img src='img/<%#Eval("StudentImg") %>' alt="" />
                            </div>
                            <div class="divRight">
                                <ul>
                                    <li>专业：<%#Eval("Major.MajorName")%></li>
                                    <li>姓名：<%#Eval("StudentName")%></li>
                                    <li>性别：<%#Eval("StudentSex")%></li>
                                    <li>电话：<%#Eval("StudentPhone")%></li>
                                    <li>邮箱：<%#Eval("StudentMail")%></li>
                                </ul>
                            </div>
                        </div>
                    </ItemTemplate>
                    <FooterTemplate>
                        </div>
                    </FooterTemplate>
                </asp:Repeater>
            </ItemTemplate>
        </asp:Repeater>
    </div>
    </form>
</body>
</html>
```

```
public partial class Demo02_03 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindMajor();
    }

    #region 绑定专业
    private void BindMajor()
    {
        MajorDAL dal = new MajorDAL();
        this.rptMajor.DataSource = dal.List();
        this.rptMajor.DataBind();
    }
    #endregion

    #region 绑定专业的同时绑定学生
    protected void rptMajor_ItemDataBound(object sender, RepeaterItemEventArgs e)
    {
        //只对数据项模板进行操作
        if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
        {
            string MajorId = (e.Item.FindControl("hdMajorId") as HiddenField).Value;
            StudentDAL dal = new StudentDAL();
            List<StudentEntity> list = new List<StudentEntity>();
            list = dal.List().Where(p => p.MajorId == int.Parse(MajorId)).ToList();
            //绑定第一个repeater
            Repeater rptStudent = e.Item.FindControl("rptStudent") as Repeater;
            rptStudent.DataSource = list;
            rptStudent.DataBind();
        }
    }
    #endregion
}
```

## 四、DataList

DataList：用于展示“重复”的数据，有默认样式为Table

​	（1）ItemTemplate对应的是talbe中的td

​	（2）默认表格中只有1列，通过设置RepeatColumns属性改变

​	（3）默认表格是纵向（垂直），通过设置RepeatDirection属性改变

​	（4）默认DataList以Table布局，通过设置RepeatLayout属性改变(flow)

**使用DataList绑定学生数据，并实现修改和删除信息的功能：**

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>DataList的使用</title>
    <style type="text/css">
        .divStudent{width:400px; height:190px; float:left; border:solid 1px gray; margin:6px;}
        .divLeft{width:130px; text-align:center; float:left;}
        .divLeft img{ width:120px; height:150px; margin-top:5px;}
        .divRight{width:260px; float:left;}
        .divRight ul{ list-style-type:none; margin:0px; padding:0px;}
        .divRight li{ height:30px; line-height:30px; font-size:13px;}
    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <asp:DataList ID="dlistStudent" runat="server" RepeatColumns="3" 
            RepeatDirection="Horizontal" oneditcommand="dlistStudent_EditCommand" 
            onitemdatabound="dlistStudent_ItemDataBound" 
            onupdatecommand="dlistStudent_UpdateCommand" DataKeyField="StudentId" 
            ondeletecommand="dlistStudent_DeleteCommand" 
            oncancelcommand="dlistStudent_CancelCommand">
            <ItemTemplate>
                <asp:HiddenField ID="hdStudentId" runat="server" Value='<%#Eval("StudentId") %>' />
                <div class="divStudent">
                    <div class="divLeft">
                        <img src="img/<%#Eval("StudentImg") %>" alt="" />
                    </div>
                    <div class="divRight">
                        <ul>
                            <li>专业：<%#Eval("Major.MajorName")%></li>
                            <li>姓名：<%#Eval("StudentName")%></li>
                            <li>性别：<%#Eval("StudentSex")%></li>
                            <li>电话：<%#Eval("StudentPhone")%></li>
                            <li>邮箱：<%#Eval("StudentMail")%></li>
                            <li>
                                <asp:LinkButton ID="lbtnDelete" runat="server" CommandName="delete" OnClientClick="return confirm('确认删除？')">删除</asp:LinkButton>
                                <asp:LinkButton ID="lbtnEdit" runat="server" CommandName="edit">编辑</asp:LinkButton>
                            </li>
                        </ul>
                    </div>
                </div>                
            </ItemTemplate>
            <EditItemTemplate>
                <asp:HiddenField ID="hdStudentId" runat="server" Value='<%#Eval("StudentId") %>' />
                <div class="divStudent">
                    <div class="divLeft">
                        <img src="img/<%#Eval("StudentImg") %>" alt="" />
                    </div>
                    <div class="divRight">
                        <ul>
                            <li>专业：
                                <asp:HiddenField ID="hdMajorId" runat="server" Value='<%#Eval("MajorId") %>' />
                                <asp:DropDownList  ID="ddlMajor" runat="server">
                                    
                                </asp:DropDownList>
                            </li>
                            <li>姓名：<asp:TextBox ID="txtName" runat="server" Text='<%#Eval("StudentName")%>'></asp:TextBox></li>
                            <li>性别：
                                <asp:HiddenField ID="hdSex" runat="server" Value='<%#Eval("StudentSex") %>' />
                                <asp:RadioButtonList ID="rblSex" runat="server" RepeatDirection="Horizontal" RepeatColumns="2" RepeatLayout="Flow">
                                    <asp:ListItem Value="男">男</asp:ListItem>
                                    <asp:ListItem Value="女">女</asp:ListItem>
                                </asp:RadioButtonList>
                            </li>
                            <li>电话：<asp:TextBox ID="txtPhone" runat="server" Text='<%#Eval("StudentPhone")%>'></asp:TextBox></li>
                            <li>邮箱：<asp:TextBox ID="txtMail" runat="server" Text='<%#Eval("StudentMail")%>'></asp:TextBox></li>
                            <li>
                                <asp:LinkButton ID="lbtnUpdate" runat="server" CommandName="Update">保存</asp:LinkButton>
                                <asp:LinkButton ID="lbtnCancel" runat="server" CommandName="cancel">取消</asp:LinkButton>
                            </li>
                        </ul>
                    </div>
                </div>                
            </EditItemTemplate>
        </asp:DataList>
    </div>
    </form>
</body>
</html>
```

```
public partial class Demo03 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindStudent();
    }

    #region 绑定学生信息-表格
    private void BindStudent()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        //绑定DataList
        this.dlistStudent.DataSource = list;
        this.dlistStudent.DataBind();
    }
    #endregion

    #region 获取专业
    private List<MajorEntity> GetMajorList()
    {
        MajorDAL dal = new MajorDAL();
        return dal.List();
    }
    #endregion

    #region 点击编辑按钮
    protected void dlistStudent_EditCommand(object source, DataListCommandEventArgs e)
    {
        this.dlistStudent.EditItemIndex = e.Item.ItemIndex;
        BindStudent();
    }
    #endregion

    protected void dlistStudent_ItemDataBound(object sender, DataListItemEventArgs e)
    {
        //绑定专业
        DropDownList ddlMajor = e.Item.FindControl("ddlMajor") as DropDownList;
        if (ddlMajor != null)
        {            
            ddlMajor.DataTextField = "MajorName";
            ddlMajor.DataValueField = "MajorId";
            ddlMajor.DataSource = GetMajorList();
            ddlMajor.DataBind();
            ddlMajor.Items.Insert(0, new ListItem("--请选择--", "0"));
            HiddenField hdMajorId = e.Item.FindControl("hdMajorId") as HiddenField;
            ddlMajor.SelectedValue = hdMajorId.Value;
        }
        //绑定性别
        RadioButtonList rblSex = e.Item.FindControl("rblSex") as RadioButtonList;
        if (rblSex != null)
        {
            HiddenField hdSex = e.Item.FindControl("hdSex") as HiddenField;
            rblSex.SelectedValue = hdSex.Value;
        }
    }

    #region 修改学生信息
    protected void dlistStudent_UpdateCommand(object source, DataListCommandEventArgs e)
    {
        StudentEntity entity = new StudentEntity();
        StudentDAL dal = new StudentDAL();
        entity = dal.Detail(int.Parse(this.dlistStudent.DataKeys[e.Item.ItemIndex].ToString()));
        entity.MajorId = int.Parse((e.Item.FindControl("ddlMajor") as DropDownList).SelectedValue);
        entity.StudentName = (e.Item.FindControl("txtName") as TextBox).Text;
        entity.StudentSex = (e.Item.FindControl("rblSex") as RadioButtonList).SelectedValue;
        entity.StudentPhone = (e.Item.FindControl("txtPhone") as TextBox).Text;
        entity.StudentMail = (e.Item.FindControl("txtMail") as TextBox).Text;
        dal.Update(entity);
        this.dlistStudent.EditItemIndex = -1;
        BindStudent();
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('修改成功！');</script>");
    }
    #endregion

    #region 删除学生
    protected void dlistStudent_DeleteCommand(object source, DataListCommandEventArgs e)
    {
        StudentDAL dal = new StudentDAL();
        dal.Delete(int.Parse(this.dlistStudent.DataKeys[e.Item.ItemIndex].ToString()));
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('删除成功');</script>");
        BindStudent();        
    }
    #endregion

    #region  取消
    protected void dlistStudent_CancelCommand(object source, DataListCommandEventArgs e)
    {
        this.dlistStudent.EditItemIndex = -1;
        BindStudent();
    }
    #endregion
}
```

## 五、GridView

GridView控件以表格的形式显示数据源的数据，每列表示一个字段，而每行表示一条记录。

```
属性				   描述
AllowPaging			设置是否启用分页功能
Columns				获取GridView控件中列字段的集合
PageCount			获取在GridView控件中显示数据源记录所需的页数
PageIndex			获取或设置当前显示页的索引
PageSize			设置GridView控件每次显示的最大记录条数
```

GridView自带分页效果实现：

（1）GridView的AllowPaging属性。AllowPaging：是否同意分页。假设AllowPaging=“true”就是同意分页。否则

就是不同意使用分页。

（2）GridView的PageSize属性。在GridView控件的属性中能够设置每页显示的数据记录的个数。默认情况下

PageSize的值是10，也能够依据须要进行设置。假设想要对分页编码进行设置的话，能够在HTML代码中为

GridView控件加入分页导航条形式代码。也就是启用GridView的PagerSettings属性，在PagerSettings属性中能

够设置依据须要设置Mode的值，来实现分页编码的显示效果。

### （1）套用样式直接显示数据

```
<h1>GridView套用样式直接显示数据</h1>
<div>
    <asp:GridView ID="gvStudent1" runat="server" CellPadding="4" 
    	ForeColor="#333333" GridLines="None"  Width="876px">
        <AlternatingRowStyle BackColor="White" />
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
    </asp:GridView>
</div>
```

```
public partial class Demo04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.gvStudent1.DataSource = list;
        this.gvStudent1.DataBind();
    }
}
```

### （2）使用BoundField手动绑定字段

```
<h1>GridView使用BoundField手动绑定字段</h1>
<div>
    <asp:GridView ID="gvStudent2" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:BoundField DataField="StudentId" HeaderText="编号" />
        <asp:BoundField DataField="Major.MajorName" HeaderText="专业名称" />
        <asp:BoundField DataField="StudentName" HeaderText="学生姓名" />
        <asp:BoundField DataField="StudentSex" HeaderText="学生性别" />
        <asp:BoundField DataField="StudentPhone" HeaderText="学生电话" />
        <asp:BoundField DataField="StudentMail" HeaderText="学生邮箱" />
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
    </asp:GridView>
</div>
```

```
public partial class Demo04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.gvStudent2.DataSource = list;
        this.gvStudent2.DataBind();
    }
}
```

### （3）模板列绑定数据

```
<h1>GridView使用TemplateField模板列手写绑定数据(也可以在设计器中将普通列转换为模板列)</h1>
<div>
    <asp:GridView ID="gvStudent3" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:TemplateField>
        <HeaderTemplate>编号</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentId")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>专业名称</HeaderTemplate>
        <ItemTemplate><%#Eval("Major.MajorName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生姓名</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生性别</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentSex")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生电话</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentPhone")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生邮箱</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentMail")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生照片</HeaderTemplate>
        <ItemTemplate>
        <asp:Image ID="imgPhoto" runat="server" ImageUrl='<%#"img/"+Eval("StudentImg") %>' Width="60" Height="80" />
        </ItemTemplate>
        </asp:TemplateField>
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
    </asp:GridView>
</div>
```

```
public partial class Demo04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.gvStudent3.DataSource = list;
        this.gvStudent3.DataBind();
    }
}
```

### （4）调用函数进行数据处理

将性别男--》帅哥，女--》美女

```
<h1>简单的数据处理-将 男-》帅哥；女-》美女</h1>
<div>
    <asp:GridView ID="gvStudent4" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:TemplateField>
        <HeaderTemplate>编号</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentId")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>专业名称</HeaderTemplate>
        <ItemTemplate><%#Eval("Major.MajorName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生姓名</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生性别</HeaderTemplate>
        <ItemTemplate><%# ChangeSex (Eval("StudentSex").ToString())%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生电话</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentPhone")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生邮箱</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentMail")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生照片</HeaderTemplate>
        <ItemTemplate>
        <asp:Image ID="imgPhoto" runat="server" ImageUrl='<%#"img/"+Eval("StudentImg") %>' Width="60" Height="80" />
        </ItemTemplate>
        </asp:TemplateField>
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
    </asp:GridView>
</div>
```

```
public partial class Demo04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.gvStudent4.DataSource = list;
        this.gvStudent4.DataBind();
    }

    public string ChangeSex(string strSex)
    {
        if (strSex.Equals("男"))
            return "帅哥";
        else if (strSex.Equals("女"))
            return "美女";
        else
            return "";
    }
}
```

### （5）绑定事件中数据处理

将性别男--》帅哥，女--》美女

```
<h1>在项目绑定事件中数据处理-将 男-》帅哥；女-》美女</h1>
<div>
    <asp:GridView ID="gvStudent5" runat="server"  CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False" onrowdatabound="gvStudent5_RowDataBound">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:TemplateField>
        <HeaderTemplate>编号</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentId")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>专业名称</HeaderTemplate>
        <ItemTemplate><%#Eval("Major.MajorName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生姓名</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生性别</HeaderTemplate>
        <ItemTemplate>
        <asp:Label ID="lblSex" runat="server" Text='<%# Eval("StudentSex").ToString()%>'></asp:Label>
        </ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生电话</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentPhone")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生邮箱</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentMail")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生照片</HeaderTemplate>
        <ItemTemplate>
        <asp:Image ID="imgPhoto" runat="server" ImageUrl='<%#"img/"+Eval("StudentImg") %>' Width="60" Height="80" />
        </ItemTemplate>
        </asp:TemplateField>
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
    </asp:GridView>
</div>
```

```
public partial class Demo04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.gvStudent5.DataSource = list;
        this.gvStudent5.DataBind();
    }

    #region 数据绑定事件
    protected void gvStudent5_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType != DataControlRowType.DataRow)
            return;
        Label lblSex = e.Row.FindControl("lblSex") as Label;
        if (lblSex != null)
        {
            if (lblSex.Text.Equals("男"))
                lblSex.Text = "帅哥";
            if (lblSex.Text.Equals("女"))
                lblSex.Text = "美女";
        }
    }
    #endregion
}
```

### （6）页面中进行数据处理

将性别男--》帅哥，女--》美女

```
<h1>在页面中利用 ? : 直接处理-将 男-》帅哥；女-》美女</h1>
<div>
    <asp:GridView ID="gvStudent6" runat="server"  CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False" onrowdatabound="gvStudent5_RowDataBound">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:TemplateField>
        <HeaderTemplate>编号</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentId")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>专业名称</HeaderTemplate>
        <ItemTemplate><%#Eval("Major.MajorName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生姓名</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentName")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生性别</HeaderTemplate>
        <ItemTemplate>
        <asp:Label ID="lblSex" runat="server" Text='<%# Eval("StudentSex").ToString().Equals("男")?"帅哥":"美女"%>'></asp:Label>
        </ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生电话</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentPhone")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生邮箱</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentMail")%></ItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生照片</HeaderTemplate>
        <ItemTemplate>
        <asp:Image ID="imgPhoto" runat="server" ImageUrl='<%#"img/"+Eval("StudentImg") %>' Width="60" Height="80" />
        </ItemTemplate>
        </asp:TemplateField>
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
    </asp:GridView>
</div>
```

```
public partial class Demo04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        this.gvStudent6.DataSource = list;
        this.gvStudent6.DataBind();
    }
}
```

### （7）控件自带的分页效果

```
<h2>自带的分页效果</h2>
<div>
    <asp:GridView ID="gvStudent1" runat="server" AllowPaging="True" CellPadding="4" 
        ForeColor="#333333" GridLines="None" PageSize="3" Width="876px" 
        AutoGenerateColumns="False" AllowSorting="True" 
        onpageindexchanging="gvStudent1_PageIndexChanging">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:BoundField DataField="StudentId" HeaderText="编号" />
        <asp:BoundField DataField="Major.MajorName" HeaderText="专业名称" />
        <asp:BoundField DataField="StudentName" HeaderText="学生姓名" />
        <asp:BoundField DataField="StudentSex" HeaderText="学生性别" />
        <asp:BoundField DataField="StudentPhone" HeaderText="学生电话" />
        <asp:BoundField DataField="StudentMail" HeaderText="学生邮箱" />
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />
        <PagerSettings Mode="NumericFirstLast" />       
    </asp:GridView>
</div>
```

```
public partial class Demo04_01 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            BindData();
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        //绑定第一个列表
        this.gvStudent1.DataSource = list;       
        this.gvStudent1.DataBind();
    }

    #region 分页
    protected void gvStudent1_PageIndexChanging(object sender, GridViewPageEventArgs e)
    {
        this.gvStudent1.PageIndex = e.NewPageIndex;
        BindData();
    }
    #endregion
}
```

### （8）自定义分页效果

```
<h2>自定义分页效果</h2>
<div>
    <asp:GridView ID="gvStudent1" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:BoundField DataField="StudentId" HeaderText="编号" />
        <asp:BoundField DataField="Major.MajorName" HeaderText="专业名称" />
        <asp:BoundField DataField="StudentName" HeaderText="学生姓名" />
        <asp:BoundField DataField="StudentSex" HeaderText="学生性别" />
        <asp:BoundField DataField="StudentPhone" HeaderText="学生电话" />
        <asp:BoundField DataField="StudentMail" HeaderText="学生邮箱" />
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />         
    </asp:GridView>
</div>
<div>
    <asp:LinkButton ID="lblFirst" runat="server" onclick="lblFirst_Click">首页</asp:LinkButton> |
    <asp:LinkButton ID="lblPrev" runat="server" onclick="lblPrev_Click">上一页</asp:LinkButton> |
    <asp:LinkButton ID="lblNext" runat="server" onclick="lblNext_Click">下一页</asp:LinkButton> |
    <asp:LinkButton ID="lblLast" runat="server" onclick="lblLast_Click">末页</asp:LinkButton> |
    第
    <asp:DropDownList ID="ddlPage" runat="server" AutoPostBack="True" 
    onselectedindexchanged="ddlPage_SelectedIndexChanged">
    </asp:DropDownList>
    页
</div>
```

```
public partial class Demo04_02 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            ViewState["PageSize"] = 3;
            ViewState["PageIndex"] = 1; 
            ViewState["PageCount"] = 0;
            BindData();
        }
    }

    private void BindData()
    {
        StudentDAL dal = new StudentDAL();
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.List();
        //绑定第一个列表
        int pageIndex = int.Parse(ViewState["PageIndex"].ToString());
        int PageSize = int.Parse(ViewState["PageSize"].ToString());
        int pageCount = list.Count % PageSize == 0 ? list.Count / PageSize : list.Count / PageSize + 1;
        ViewState["PageCount"] = pageCount;
        //GetRange:长度超过界限会报错，写法复杂
        //this.gvStudent1.DataSource = list.GetRange((pageIndex - 1) * PageSize, pageIndex * PageSize > list.Count ? list.Count - (pageIndex - 1) * PageSize : PageSize);
        //使用skip设置开始位置，take设置长度更加方便
        this.gvStudent1.DataSource = list.Skip((pageIndex - 1) * PageSize).Take(PageSize);
        this.gvStudent1.DataBind();
        //绑定分页下拉框       
        this.ddlPage.Items.Clear();
        for (int i = 1; i <= pageCount; i++)
        {
            this.ddlPage.Items.Add(new ListItem(i.ToString(), i.ToString()));
        }
        this.ddlPage.SelectedValue = pageIndex.ToString();
        
    }

    #region 分页下拉框值改变的时候
    protected void ddlPage_SelectedIndexChanged(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(this.ddlPage.SelectedValue);
        BindData();
    }
    #endregion

    #region 首页
    protected void lblFirst_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = 1;
        BindData();
    }
    #endregion

    #region 末页
    protected void lblLast_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(ViewState["PageCount"].ToString());
        BindData();
    }
    #endregion

    #region 上一页
    protected void lblPrev_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) <= 1)
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) - 1;
        BindData();
    }
    #endregion

    #region 下一页
    protected void lblNext_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) >= int.Parse(ViewState["PageCount"].ToString()))
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString())+1;
        BindData();
    }
    #endregion
}
```

### （9）数据库分页

```
<h2>自定义分页效果-数据库分页</h2>
<div>
    <asp:GridView ID="gvStudent1" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:BoundField DataField="StudentId" HeaderText="编号" />
        <asp:BoundField DataField="Major.MajorName" HeaderText="专业名称" />
        <asp:BoundField DataField="StudentName" HeaderText="学生姓名" />
        <asp:BoundField DataField="StudentSex" HeaderText="学生性别" />
        <asp:BoundField DataField="StudentPhone" HeaderText="学生电话" />
        <asp:BoundField DataField="StudentMail" HeaderText="学生邮箱" />
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />          
    </asp:GridView>
</div>
<div>
    <asp:LinkButton ID="lblFirst" runat="server" onclick="lblFirst_Click">首页</asp:LinkButton> |
    <asp:LinkButton ID="lblPrev" runat="server" onclick="lblPrev_Click">上一页</asp:LinkButton> |
    <asp:LinkButton ID="lblNext" runat="server" onclick="lblNext_Click">下一页</asp:LinkButton> |
    <asp:LinkButton ID="lblLast" runat="server" onclick="lblLast_Click">末页</asp:LinkButton> |
    第
    <asp:DropDownList ID="ddlPage" runat="server" AutoPostBack="True" 
    onselectedindexchanged="ddlPage_SelectedIndexChanged">
    </asp:DropDownList>
    页
</div>
```

**pageHelper.cs**

```
public class PageHelper
{
    #region 计算总页数
    public static int GetTotalPage(int totalRecord, int pageSize)
    {
        int totalPage = 0;
        if (totalRecord % pageSize == 0)
        	totalPage = totalRecord / pageSize;
        else
        	totalPage = totalRecord / pageSize + 1;
        return totalPage;
    }
    #endregion

    #region 计算当前页
    public static int ComputeCurrPage(int currPage, int totalPage)
    {
        if (currPage < 1)
        	currPage = 1;
        if (currPage > totalPage)
        	currPage = totalPage;
        return currPage;
    }
    
    public static int ComputeCurrPage(int pageIndex, int pageSize, int recordCount)
    {
        int pageCount = recordCount % pageSize == 0 ? recordCount / pageSize : recordCount / pageSize + 1;
        if (pageIndex < 1)
        	pageIndex = 1;
        if (pageIndex > pageCount)
        	pageIndex = pageCount;
        return pageIndex;
    }
    #endregion
}
```

**页面C#代码：**

```
public partial class Demo04_03 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

        if (!IsPostBack)
        {
            ViewState["PageIndex"] = 1;  //当前页
            ViewState["PageCount"] = 0; //总页数
            BindData();
        }
    }

    private void BindData()
    {
        int PageIndex = int.Parse(ViewState["PageIndex"].ToString());
        int PageSize = 10; //页码大小
        StudentDAL dal = new StudentDAL();
        int RecordCount = 0;
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.ListPage(PageSize, PageIndex, out RecordCount);
        //绑定第一个列表
        this.gvStudent1.DataSource = list;
        this.gvStudent1.DataBind();
        int PageCount = PageHelper.GetTotalPage(RecordCount, PageSize);
        PageIndex = PageHelper.ComputeCurrPage(PageIndex, PageCount);
        ViewState["PageIndex"] = PageIndex;
        ViewState["PageCount"] = PageCount;
        //绑定分页下拉框       
        this.ddlPage.Items.Clear();
        for (int i = 1; i <= PageCount; i++)
        {
            this.ddlPage.Items.Add(new ListItem(i.ToString(), i.ToString()));
        }
        this.ddlPage.SelectedValue = PageIndex.ToString();
    }

    #region 分页下拉框值改变的时候
    protected void ddlPage_SelectedIndexChanged(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(this.ddlPage.SelectedValue);
        BindData();
    }
    #endregion

    #region 首页
    protected void lblFirst_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = 1;
        BindData();
    }
    #endregion

    #region 末页
    protected void lblLast_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(ViewState["PageCount"].ToString());
        BindData();
    }
    #endregion

    #region 上一页
    protected void lblPrev_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) <= 1)
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) - 1;
        BindData();
    }
    #endregion

    #region 下一页
    protected void lblNext_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) >= int.Parse(ViewState["PageCount"].ToString()))
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) + 1;
        BindData();
    }
    #endregion
}
```

### （10）分页后排序

分页后排序的制作步骤：

（1）设置GridView的AllowSorting="True"属性（允许点列头排序）。

（2）设置列头的SortExpression="关键字"属性（排序关键字（字段名））。

（3）处理GridView的Sorting事件。

​		3.1：事件参数：SortExpression（当前列的排序关键字）

​		3.2：事件参数：SortDirection（排序的升降(状态无法保存)）

​		3.3：使用ViewState解决3.2的问题

```
<div>
    <asp:GridView ID="gvStudent1" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="876px" 
        AutoGenerateColumns="False" AllowSorting="true" 
        onsorting="gvStudent1_Sorting">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:BoundField DataField="StudentId" HeaderText="编号" SortExpression="StudentId" />
        <asp:BoundField DataField="Major.MajorName" HeaderText="专业名称" SortExpression="MajorName" />
        <asp:BoundField DataField="StudentName" HeaderText="学生姓名" SortExpression="StudentName" />
        <asp:BoundField DataField="StudentSex" HeaderText="学生性别" SortExpression="StudentSex" />
        <asp:BoundField DataField="StudentPhone" HeaderText="学生电话" SortExpression="StudentPhone" />
        <asp:BoundField DataField="StudentMail" HeaderText="学生邮箱" SortExpression="StudentMail" />
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />          
    </asp:GridView>
</div>
<div>
    <asp:LinkButton ID="lblFirst" runat="server" onclick="lblFirst_Click">首页</asp:LinkButton> |
    <asp:LinkButton ID="lblPrev" runat="server" onclick="lblPrev_Click">上一页</asp:LinkButton> |
    <asp:LinkButton ID="lblNext" runat="server" onclick="lblNext_Click">下一页</asp:LinkButton> |
    <asp:LinkButton ID="lblLast" runat="server" onclick="lblLast_Click">末页</asp:LinkButton> |
    第
    <asp:DropDownList ID="ddlPage" runat="server" AutoPostBack="True" 
    onselectedindexchanged="ddlPage_SelectedIndexChanged">
    </asp:DropDownList>
    页
</div>
```

```
public partial class Demo04_04 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

        if (!IsPostBack)
        {
            ViewState["PageIndex"] = 1;  //当前页
            ViewState["PageCount"] = 0; //总页数
            ViewState["SortExpression"] = "StudentId"; //排序字段
            ViewState["SortDirection"] = "asc"; //排序方式
            BindData();
        }
    }

    private void BindData()
    {
        int PageIndex = int.Parse(ViewState["PageIndex"].ToString());
        int PageSize = 10; //页码大小
        StudentDAL dal = new StudentDAL();
        int RecordCount = 0;
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.ListPage(PageSize, PageIndex, out RecordCount);
        //实现分页后排序
        if (ViewState["SortExpression"].Equals("StudentId"))
        {
            if (ViewState["SortDirection"].Equals("asc"))
                list = (from items in list orderby items.StudentId ascending select items).ToList();
            if (ViewState["SortDirection"].Equals("desc"))
                list = (from items in list orderby items.StudentId descending select items).ToList();
        }
        //绑定第一个列表
        this.gvStudent1.DataSource = list;
        this.gvStudent1.DataBind();
        int PageCount = PageHelper.GetTotalPage(RecordCount, PageSize);
        PageIndex = PageHelper.ComputeCurrPage(PageIndex, PageCount);
        ViewState["PageIndex"] = PageIndex;
        ViewState["PageCount"] = PageCount;

        //绑定分页下拉框       
        this.ddlPage.Items.Clear();
        for (int i = 1; i <= PageCount; i++)
        {
            this.ddlPage.Items.Add(new ListItem(i.ToString(), i.ToString()));
        }
        this.ddlPage.SelectedValue = PageIndex.ToString();

    }

    //也可以这么玩
    //private void BindData()
    //{
    //    int PageIndex = int.Parse(ViewState["PageIndex"].ToString());
    //    int PageSize = 10; //页码大小
    //    StudentDAL dal = new StudentDAL();
    //    int RecordCount = 0;
    //    DataTable dt = new DataTable();
    //    dt = dal.ListPageDataTable(PageSize, PageIndex, out RecordCount);
    //    //此排序为分页后排序，如需实现分页前排序，直接修改前面的sql语句
    //    List<StudentEntity> list = new List<StudentEntity>();
    //    foreach (DataRow dr in dt.Select("1=1", ViewState["SortExpression"].ToString() + " " + ViewState["SortDirection"].ToString()))
    //    {
    //        StudentEntity entity = new StudentEntity();
    //        entity.StudentId = int.Parse(dr["StudentId"].ToString());
    //        entity.MajorId = int.Parse(dr["MajorId"].ToString());
    //        entity.StudentName = dr["StudentName"].ToString();
    //        entity.StudentSex = dr["StudentSex"].ToString();
    //        entity.StudentPhone = dr["StudentPhone"].ToString();
    //        entity.StudentMail = dr["StudentMail"].ToString();
    //        entity.StudentImg = dr["StudentImg"].ToString();
    //        entity.Major = new MajorEntity();
    //        entity.Major.MajorId = int.Parse(dr["StudentId"].ToString());
    //        entity.Major.MajorName = dr["MajorName"].ToString();
    //        list.Add(entity);
    //    }
    //    //绑定第一个列表
    //    this.gvStudent1.DataSource = list;
    //    this.gvStudent1.DataBind();
    //    int PageCount = PageHelper.GetTotalPage(RecordCount, PageSize);
    //    PageIndex = PageHelper.ComputeCurrPage(PageIndex, PageCount);
    //    ViewState["PageIndex"] = PageIndex;
    //    ViewState["PageCount"] = PageCount;

    //    //绑定分页下拉框       
    //    this.ddlPage.Items.Clear();
    //    for (int i = 1; i <= PageCount; i++)
    //    {
    //        this.ddlPage.Items.Add(new ListItem(i.ToString(), i.ToString()));
    //    }
    //    this.ddlPage.SelectedValue = PageIndex.ToString();
    //}

    #region 分页下拉框值改变的时候
    protected void ddlPage_SelectedIndexChanged(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(this.ddlPage.SelectedValue);
        BindData();
    }
    #endregion

    #region 首页
    protected void lblFirst_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = 1;
        BindData();
    }
    #endregion

    #region 末页
    protected void lblLast_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(ViewState["PageCount"].ToString());
        BindData();
    }
    #endregion

    #region 上一页
    protected void lblPrev_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) <= 1)
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) - 1;
        BindData();
    }
    #endregion

    #region 下一页
    protected void lblNext_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) >= int.Parse(ViewState["PageCount"].ToString()))
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) + 1;
        BindData();
    }
    #endregion

    #region 排序
    protected void gvStudent1_Sorting(object sender, GridViewSortEventArgs e)
    {
        ViewState["SortDirection"] = ViewState["SortDirection"] == null ? "asc" : ViewState["SortDirection"];
        if (ViewState["SortDirection"].Equals("asc"))
            ViewState["SortDirection"] = "desc";
        else
            ViewState["SortDirection"] = "asc";        
        ViewState["SortExpression"] = e.SortExpression; //保存排序关键字
        BindData();
    }
    #endregion
}
```

### （11）控件编辑删除数据

```
<h2>GridView编辑-删除数据</h2>
<div>
    <asp:GridView ID="gvStudent1" runat="server" CellPadding="4" 
        ForeColor="#333333" GridLines="None" Width="1038px" 
        AutoGenerateColumns="False" DataKeyNames="StudentId" 
        onrowcancelingedit="gvStudent1_RowCancelingEdit" 
        onrowediting="gvStudent1_RowEditing" 
        onrowupdating="gvStudent1_RowUpdating" 
        onrowdeleting="gvStudent1_RowDeleting">
        <AlternatingRowStyle BackColor="White" />
        <Columns>
        <asp:TemplateField>
        <HeaderTemplate>编号</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentId")%></ItemTemplate>
        <EditItemTemplate><%#Eval("StudentId")%></EditItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>专业名称</HeaderTemplate>
        <ItemTemplate><%#Eval("Major.MajorName")%></ItemTemplate>
        <EditItemTemplate>
        <asp:HiddenField ID="hdMajorId" runat="server" Value='<%#Eval("MajorId") %>' />
        <asp:DropDownList ID="ddlMajor" runat="server">
        </asp:DropDownList>
        </EditItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生姓名</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentName")%></ItemTemplate>
        <EditItemTemplate>
        <asp:TextBox ID="txtStuName" runat="server" Text='<%#Eval("StudentName") %>'></asp:TextBox>
        </EditItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生性别</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentSex")%></ItemTemplate>
        <EditItemTemplate>
        <asp:HiddenField ID="hdSex" runat="server" Value='<%#Eval("StudentSex") %>' />
        <asp:RadioButtonList ID="rblSex" runat="server" RepeatDirection="Horizontal" RepeatColumns="2" RepeatLayout="Flow">
        <asp:ListItem Value="男">男</asp:ListItem>
        <asp:ListItem Value="女">女</asp:ListItem>
        </asp:RadioButtonList>                   
        </EditItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生电话</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentPhone")%></ItemTemplate>
        <EditItemTemplate>
        <asp:TextBox ID="txtPhone" runat="server" Text='<%#Eval("StudentPhone") %>'>'></asp:TextBox>
        </EditItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>学生邮箱</HeaderTemplate>
        <ItemTemplate><%#Eval("StudentMail")%></ItemTemplate>
        <EditItemTemplate>
        <asp:TextBox ID="txtMail" runat="server" Text='<%#Eval("StudentMail") %>'></asp:TextBox>
        </EditItemTemplate>
        </asp:TemplateField>
        <asp:TemplateField>
        <HeaderTemplate>操作</HeaderTemplate>
        <ItemTemplate>
        <asp:LinkButton ID="lbEdit" runat="server" CommandName="edit">编辑</asp:LinkButton>
        <asp:LinkButton ID="lbDelete" runat="server" CommandName="delete" OnClientClick="return confirm('确定要删除吗？');">删除</asp:LinkButton>
        </ItemTemplate>
        <EditItemTemplate>
        <asp:LinkButton ID="lbUpdate" runat="server" CommandName="update">修改</asp:LinkButton>
        <asp:LinkButton ID="lbCancel" runat="server" CommandName="cancel">取消</asp:LinkButton>                      
        </EditItemTemplate>
        </asp:TemplateField>
        </Columns>
        <EditRowStyle BackColor="#2461BF" />
        <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
        <RowStyle BackColor="#EFF3FB" />
        <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
        <SortedAscendingCellStyle BackColor="#F5F7FB" />
        <SortedAscendingHeaderStyle BackColor="#6D95E1" />
        <SortedDescendingCellStyle BackColor="#E9EBEF" />
        <SortedDescendingHeaderStyle BackColor="#4870BE" />          
    </asp:GridView>
</div>
<div>
    <asp:LinkButton ID="lblFirst" runat="server" onclick="lblFirst_Click">首页</asp:LinkButton> |
    <asp:LinkButton ID="lblPrev" runat="server" onclick="lblPrev_Click">上一页</asp:LinkButton> |
    <asp:LinkButton ID="lblNext" runat="server" onclick="lblNext_Click">下一页</asp:LinkButton> |
    <asp:LinkButton ID="lblLast" runat="server" onclick="lblLast_Click">末页</asp:LinkButton> |
    第
    <asp:DropDownList ID="ddlPage" runat="server" AutoPostBack="True" 
    onselectedindexchanged="ddlPage_SelectedIndexChanged">
    </asp:DropDownList>
    页
</div>
```

```
public partial class Demo04_05 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

        if (!IsPostBack)
        {
            ViewState["PageIndex"] = 1;  //当前页
            ViewState["PageCount"] = 0; //总页数
            BindData();
        }
    }

    private void BindData()
    {
        int PageIndex = int.Parse(ViewState["PageIndex"].ToString());
        int PageSize = 10; //页码大小
        StudentDAL dal = new StudentDAL();
        int RecordCount = 0;
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.ListPage(PageSize, PageIndex, out RecordCount);
        //绑定第一个列表
        this.gvStudent1.DataSource = list;
        this.gvStudent1.DataBind();
        int PageCount = PageHelper.GetTotalPage(RecordCount, PageSize);
        PageIndex = PageHelper.ComputeCurrPage(PageIndex, PageCount);
        ViewState["PageIndex"] = PageIndex;
        ViewState["PageCount"] = PageCount;

        //绑定分页下拉框
        this.ddlPage.Items.Clear();
        for (int i = 1; i <= PageCount; i++)
        {
            this.ddlPage.Items.Add(new ListItem(i.ToString(), i.ToString()));
        }
        this.ddlPage.SelectedValue = PageIndex.ToString();

    }

    #region 分页下拉框值改变的时候
    protected void ddlPage_SelectedIndexChanged(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(this.ddlPage.SelectedValue);
        BindData();
    }
    #endregion

    #region 首页
    protected void lblFirst_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = 1;
        BindData();
    }
    #endregion

    #region 末页
    protected void lblLast_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(ViewState["PageCount"].ToString());
        BindData();
    }
    #endregion

    #region 上一页
    protected void lblPrev_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) <= 1)
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) - 1;
        BindData();
    }
    #endregion

    #region 下一页
    protected void lblNext_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) >= int.Parse(ViewState["PageCount"].ToString()))
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) + 1;
        BindData();
    }
    #endregion

    #region 获取专业
    private List<MajorEntity> GetMajorList()
    {
        MajorDAL dal = new MajorDAL();
        return dal.List();
    }
    #endregion

    #region 编辑按钮
    protected void gvStudent1_RowEditing(object sender, GridViewEditEventArgs e)
    {
        this.gvStudent1.EditIndex = e.NewEditIndex;
        BindData();
        //绑定专业
        DropDownList ddlMajor = this.gvStudent1.Rows[e.NewEditIndex].FindControl("ddlMajor") as DropDownList;
        if (ddlMajor != null)
        {
            ddlMajor.DataTextField = "MajorName";
            ddlMajor.DataValueField = "MajorId";
            ddlMajor.DataSource = GetMajorList();
            ddlMajor.DataBind();
            ddlMajor.Items.Insert(0, new ListItem("--请选择--", "0"));
            HiddenField hdMajorId = this.gvStudent1.Rows[e.NewEditIndex].FindControl("hdMajorId") as HiddenField;
            ddlMajor.SelectedValue = hdMajorId.Value;
        }
        //绑定性别
        RadioButtonList rblSex = this.gvStudent1.Rows[e.NewEditIndex].FindControl("rblSex") as RadioButtonList;
        if (rblSex != null)
        {
            HiddenField hdSex = this.gvStudent1.Rows[e.NewEditIndex].FindControl("hdSex") as HiddenField;
            rblSex.SelectedValue = hdSex.Value;
        }
    }
    #endregion

    #region 取消
    protected void gvStudent1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        this.gvStudent1.EditIndex = -1;
        BindData();
    }
    #endregion

    #region 修改数据
    protected void gvStudent1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {
        StudentEntity entity = new StudentEntity();
        StudentDAL dal = new StudentDAL();
        entity = dal.Detail(int.Parse(this.gvStudent1.DataKeys[e.RowIndex]["StudentId"].ToString()));
        entity.MajorId = int.Parse((this.gvStudent1.Rows[e.RowIndex].FindControl("ddlMajor") as DropDownList).SelectedValue);
        entity.StudentName = (this.gvStudent1.Rows[e.RowIndex].FindControl("txtStuName") as TextBox).Text;
        entity.StudentSex = (this.gvStudent1.Rows[e.RowIndex].FindControl("rblSex") as RadioButtonList).SelectedValue;
        entity.StudentPhone = (this.gvStudent1.Rows[e.RowIndex].FindControl("txtPhone") as TextBox).Text;
        entity.StudentMail = (this.gvStudent1.Rows[e.RowIndex].FindControl("txtMail") as TextBox).Text;
        dal.Update(entity);

        this.gvStudent1.EditIndex = -1;
        BindData();
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('修改成功！');</script>");
    }
    #endregion

    #region 删除
    protected void gvStudent1_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        StudentDAL dal = new StudentDAL();
        dal.Delete(int.Parse(this.gvStudent1.DataKeys[e.RowIndex]["StudentId"].ToString()));
        BindData();
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('删除成功！');</script>");
    }
    #endregion
}
```

### （12）控件编辑-批量删除数据

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>GridView编辑-批量删除数据</title>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#ckbAll").click(function () {
                //                $("#gvStudent1 td :checkbox").attr("checked", $(this).checked);
                var $isChecked = $(this).prop("checked");
                $("#gvStudent1 td :checkbox").prop("checked", $isChecked);
            })
        })
    </script>
</head>
<body>
    <form id="form1" runat="server">
    <h2>GridView编辑-删除数据</h2>
    <div>
        <asp:Button ID="btDeleteN" runat="server" Text="批量删除" 
            onclick="btDeleteN_Click" OnClientClick="return confirm('确定要删除吗？');" />
        <asp:GridView ID="gvStudent1" runat="server" CellPadding="4" 
            ForeColor="#333333" GridLines="None" Width="1038px" 
            AutoGenerateColumns="False" DataKeyNames="StudentId" 
            onrowcancelingedit="gvStudent1_RowCancelingEdit" 
            onrowediting="gvStudent1_RowEditing" 
            onrowupdating="gvStudent1_RowUpdating" 
            onrowdeleting="gvStudent1_RowDeleting">
            <AlternatingRowStyle BackColor="White" />
            <Columns>
                <asp:TemplateField>
                    <HeaderTemplate><asp:CheckBox ID="ckbAll" runat="server" ClientIDMode="Static" /></HeaderTemplate>
                    <ItemTemplate><asp:CheckBox ID="ckbSelect" runat="server" /></ItemTemplate>
                    <ItemStyle HorizontalAlign="Center" />
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>编号</HeaderTemplate>
                    <ItemTemplate><%#Eval("StudentId")%></ItemTemplate>
                    <EditItemTemplate><%#Eval("StudentId")%></EditItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>专业名称</HeaderTemplate>
                    <ItemTemplate><%#Eval("Major.MajorName")%></ItemTemplate>
                    <EditItemTemplate>
                        <asp:HiddenField ID="hdMajorId" runat="server" Value='<%#Eval("MajorId") %>' />
                        <asp:DropDownList ID="ddlMajor" runat="server">
                        </asp:DropDownList>
                    </EditItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>学生姓名</HeaderTemplate>
                    <ItemTemplate><%#Eval("StudentName")%></ItemTemplate>
                    <EditItemTemplate>
                        <asp:TextBox ID="txtStuName" runat="server" Text='<%#Eval("StudentName") %>'></asp:TextBox>
                    </EditItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>学生性别</HeaderTemplate>
                    <ItemTemplate><%#Eval("StudentSex")%></ItemTemplate>
                    <EditItemTemplate>
                        <asp:HiddenField ID="hdSex" runat="server" Value='<%#Eval("StudentSex") %>' />
                        <asp:RadioButtonList ID="rblSex" runat="server" RepeatDirection="Horizontal" RepeatColumns="2" RepeatLayout="Flow">
                            <asp:ListItem Value="男">男</asp:ListItem>
                            <asp:ListItem Value="女">女</asp:ListItem>
                        </asp:RadioButtonList>                   
                    </EditItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>学生电话</HeaderTemplate>
                    <ItemTemplate><%#Eval("StudentPhone")%></ItemTemplate>
                    <EditItemTemplate>
                        <asp:TextBox ID="txtPhone" runat="server" Text='<%#Eval("StudentPhone") %>'>'></asp:TextBox>
                    </EditItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>学生邮箱</HeaderTemplate>
                    <ItemTemplate><%#Eval("StudentMail")%></ItemTemplate>
                    <EditItemTemplate>
                        <asp:TextBox ID="txtMail" runat="server" Text='<%#Eval("StudentMail") %>'></asp:TextBox>
                    </EditItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField>
                    <HeaderTemplate>操作</HeaderTemplate>
                    <ItemTemplate>
                        <asp:LinkButton ID="lbEdit" runat="server" CommandName="edit">编辑</asp:LinkButton>
                        <asp:LinkButton ID="lbDelete" runat="server" CommandName="delete" OnClientClick="return confirm('确定要删除吗？');">删除</asp:LinkButton>
                    </ItemTemplate>
                    <EditItemTemplate>
                         <asp:LinkButton ID="lbUpdate" runat="server" CommandName="update">修改</asp:LinkButton>
                        <asp:LinkButton ID="lbCancel" runat="server" CommandName="cancel">取消</asp:LinkButton>                      
                    </EditItemTemplate>
                </asp:TemplateField>
            </Columns>
            <EditRowStyle BackColor="#2461BF" />
            <FooterStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
            <HeaderStyle BackColor="#507CD1" Font-Bold="True" ForeColor="White" />
            <PagerStyle BackColor="#2461BF" ForeColor="White" HorizontalAlign="Center" />
            <RowStyle BackColor="#EFF3FB" />
            <SelectedRowStyle BackColor="#D1DDF1" Font-Bold="True" ForeColor="#333333" />
            <SortedAscendingCellStyle BackColor="#F5F7FB" />
            <SortedAscendingHeaderStyle BackColor="#6D95E1" />
            <SortedDescendingCellStyle BackColor="#E9EBEF" />
            <SortedDescendingHeaderStyle BackColor="#4870BE" />          
        </asp:GridView>
    </div>
    <div>
        <asp:LinkButton ID="lblFirst" runat="server" onclick="lblFirst_Click">首页</asp:LinkButton> |
        <asp:LinkButton ID="lblPrev" runat="server" onclick="lblPrev_Click">上一页</asp:LinkButton> |
        <asp:LinkButton ID="lblNext" runat="server" onclick="lblNext_Click">下一页</asp:LinkButton> |
        <asp:LinkButton ID="lblLast" runat="server" onclick="lblLast_Click">末页</asp:LinkButton> |
        第
        <asp:DropDownList ID="ddlPage" runat="server" AutoPostBack="True" 
            onselectedindexchanged="ddlPage_SelectedIndexChanged">
        </asp:DropDownList>
        页
    </div>
    </form>
</body>
</html>
```

```
public partial class Demo04_06 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            ViewState["PageIndex"] = 1;  //当前页
            ViewState["PageCount"] = 0; //总页数
            BindData();
        }
    }

    private void BindData()
    {
        int PageIndex = int.Parse(ViewState["PageIndex"].ToString());
        int PageSize = 10; //页码大小
        StudentDAL dal = new StudentDAL();
        int RecordCount = 0;
        List<StudentEntity> list = new List<StudentEntity>();
        list = dal.ListPage(PageSize, PageIndex, out RecordCount);
        //绑定第一个列表
        this.gvStudent1.DataSource = list;
        this.gvStudent1.DataBind();
        int PageCount = PageHelper.GetTotalPage(RecordCount, PageSize);
        PageIndex = PageHelper.ComputeCurrPage(PageIndex, PageCount);
        ViewState["PageIndex"] = PageIndex;
        ViewState["PageCount"] = PageCount;

        //绑定分页下拉框
        this.ddlPage.Items.Clear();
        for (int i = 1; i <= PageCount; i++)
        {
            this.ddlPage.Items.Add(new ListItem(i.ToString(), i.ToString()));
        }
        this.ddlPage.SelectedValue = PageIndex.ToString();

    }

    #region 分页下拉框值改变的时候
    protected void ddlPage_SelectedIndexChanged(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(this.ddlPage.SelectedValue);
        BindData();
    }
    #endregion

    #region 首页
    protected void lblFirst_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = 1;
        BindData();
    }
    #endregion

    #region 末页
    protected void lblLast_Click(object sender, EventArgs e)
    {
        ViewState["PageIndex"] = int.Parse(ViewState["PageCount"].ToString());
        BindData();
    }
    #endregion

    #region 上一页
    protected void lblPrev_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) <= 1)
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) - 1;
        BindData();
    }
    #endregion

    #region 下一页
    protected void lblNext_Click(object sender, EventArgs e)
    {
        if (int.Parse(ViewState["PageIndex"].ToString()) >= int.Parse(ViewState["PageCount"].ToString()))
            return;
        ViewState["PageIndex"] = int.Parse(ViewState["PageIndex"].ToString()) + 1;
        BindData();
    }
    #endregion

    #region 获取专业
    private List<MajorEntity> GetMajorList()
    {
        MajorDAL dal = new MajorDAL();
        return dal.List();
    }
    #endregion

    #region 编辑按钮
    protected void gvStudent1_RowEditing(object sender, GridViewEditEventArgs e)
    {
        this.gvStudent1.EditIndex = e.NewEditIndex;
        BindData();
        //绑定专业
        DropDownList ddlMajor = this.gvStudent1.Rows[e.NewEditIndex].FindControl("ddlMajor") as DropDownList;
        if (ddlMajor != null)
        {
            ddlMajor.DataTextField = "MajorName";
            ddlMajor.DataValueField = "MajorId";
            ddlMajor.DataSource = GetMajorList();
            ddlMajor.DataBind();
            ddlMajor.Items.Insert(0, new ListItem("--请选择--", "0"));
            HiddenField hdMajorId = this.gvStudent1.Rows[e.NewEditIndex].FindControl("hdMajorId") as HiddenField;
            ddlMajor.SelectedValue = hdMajorId.Value;
        }
        //绑定性别
        RadioButtonList rblSex = this.gvStudent1.Rows[e.NewEditIndex].FindControl("rblSex") as RadioButtonList;
        if (rblSex != null)
        {
            HiddenField hdSex = this.gvStudent1.Rows[e.NewEditIndex].FindControl("hdSex") as HiddenField;
            rblSex.SelectedValue = hdSex.Value;
        }

    }
    #endregion

    #region 取消
    protected void gvStudent1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)
    {
        this.gvStudent1.EditIndex = -1;
        BindData();
    }
    #endregion

    #region 修改数据
    protected void gvStudent1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {
        StudentEntity entity = new StudentEntity();
        StudentDAL dal = new StudentDAL();
        entity = dal.Detail(int.Parse(this.gvStudent1.DataKeys[e.RowIndex]["StudentId"].ToString()));
        entity.MajorId = int.Parse((this.gvStudent1.Rows[e.RowIndex].FindControl("ddlMajor") as DropDownList).SelectedValue);
        entity.StudentName = (this.gvStudent1.Rows[e.RowIndex].FindControl("txtStuName") as TextBox).Text;
        entity.StudentSex = (this.gvStudent1.Rows[e.RowIndex].FindControl("rblSex") as RadioButtonList).SelectedValue;
        entity.StudentPhone = (this.gvStudent1.Rows[e.RowIndex].FindControl("txtPhone") as TextBox).Text;
        entity.StudentMail = (this.gvStudent1.Rows[e.RowIndex].FindControl("txtMail") as TextBox).Text;
        dal.Update(entity);

        this.gvStudent1.EditIndex = -1;
        BindData();
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('修改成功！');</script>");
    }
    #endregion

    #region 删除
    protected void gvStudent1_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        StudentDAL dal = new StudentDAL();
        dal.Delete(int.Parse(this.gvStudent1.DataKeys[e.RowIndex]["StudentId"].ToString()));
        BindData();
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('删除成功！');</script>");
    }
    #endregion

    #region 批量删除
    protected void btDeleteN_Click(object sender, EventArgs e)
    {
        string strIdList = "";
        foreach (GridViewRow row in this.gvStudent1.Rows)
        {
            if (row.RowType == DataControlRowType.DataRow) //判断是否为数据行
            {
                CheckBox ckb = row.FindControl("ckbSelect") as CheckBox;
                if (ckb.Checked == true)
                {
                    if (!strIdList.Equals(""))
                        strIdList += ",";
                    strIdList += this.gvStudent1.DataKeys[row.RowIndex]["StudentId"].ToString();
                }
            }
        }
        if (strIdList.Equals(""))
        {
            Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('没有选择删除项！');</script>");
            return;
        }
        StudentDAL dal = new StudentDAL();
        dal.Delete(strIdList);
        Page.ClientScript.RegisterStartupScript(this.GetType(), "js", "<script>alert('删除成功！');</script>");
        BindData();
    }
    #endregion
}
```

